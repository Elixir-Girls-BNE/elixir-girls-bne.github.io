<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Elixir Girls Guides Heroku</title>

    <link href="/stylesheets/normalize.css" rel="stylesheet" /><link href="/stylesheets/all.css" rel="stylesheet" />

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Elixir Girls website">
    <meta name="author" content="Sorcha Abel">

    <!-- Open Graph data -->
    <meta property="og:title" content="Elixir Girls" />
    <meta property="og:type" content="event" />
    <meta property="og:url" content="http://elixirgirls.com" />
    <meta property="og:image" content="http://elixirgirls.com/img/header.jpg" />
    <meta property="og:description" content="Our aim is to make technology more approachable by creating a fun and friendly environment for people to come together and learn about Elixir, Phoenix and Functional Programming" />

    <!-- Bootstrap Core CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="/vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="/stylesheets/creative.css" rel="stylesheet">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="guides guides_channels">
<nav id="mainNav" class="navbar navbar-default navbar-fixed-top guide-nav-bar">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
            </button>
            <a class="navbar-brand page-scroll" href="/#page-top">Elixir Girls</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="page-scroll" href="/#about">About</a>
                </li>
                <li>
                    <a class="page-scroll" href="/#events">Events</a>
                </li>
                <li>
                    <a class="page-scroll" href="/guides/">Guides</a>
                </li>
                <li>
                    <a class="page-scroll" href="/#sponsors">Sponsors</a>
                </li>
                <li>
                    <a class="page-scroll" href="/#contact">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>

<div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Elixir Girls Guides</a>
        </div>
        <!-- /.navbar-header -->

        <!-- /.navbar-top-links -->

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav">
                <ul class="nav" id="side-menu nav">
                    <li>
                        <a id="dropdown-menu" href="#">Installation</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="/install-guides/mac.html">Mac</a>
                            </li>
                            <li>
                                <a href="/install-guides/windows.html">Windows</a>
                            </li>
                            <li>
                                <a href="/install-guides/linux.html">Linux</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="/install-guides/dev-tools.html">Additional Tools</a>
                    </li>
                    <li>
                        <a href="/guides/elixir-beginners-guide.html">Beginner's Guide</a>
                    </li>
                    <li>
                        <a href="/guides/blog-beginners-guide.html">Beginner's Blog Guide</a>
                    </li>
                    <li>
                        <a href="/guides/blog-git-guide.html">Push Blog to Git</a>
                    </li>
                    <li>
                        <a href="/guides/heroku-push-blog-guide.html">Deploy Blog to Heroku</a>
                    </li>
                    <li>
                        <a href="/guides/slackir.html">Slackir App</a>
                    </li>
                    <li>
                        <a href="/guides/channels.html">Channels</a>
                    </li>
                    <li>
                        <a href="/guides/persistence.html">Persistence</a>
                    </li>
                    <li>
                        <a href="/guides/version-control-git.html">Version Control (Git)</a>
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>

    <div id="page-wrapper">
        <h1>Deploying blog to Heroku</h1>
            <p>If you haven't already, you will need to sign up for a free Heroku account. Simply head on over to <a href="https://signup.heroku.com/">Heroku</a> and fill in the form.</p>
        <h2>Heroku Toolbelt</h2>
        <p>Once you have signed up, you will need to download the correct version of the <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku Toolbelt</a> for your operating system.</p>
        <p>Now we are all set to create the Heroku application!</p>
        <p>From the terminal window, in your project directory, run the following command:</p>
        <xmp>heroku create --buildpack "https://github.com/HashNuke/heroku-buildpack-elixir.git"</xmp>
        <p>You should see output similar that below:</p>
        <p><img src="/images/heroku-create.png" alt="heroku commands" width="100%" ></p>
        <p>The name of your Heroku application what comes after “Creating app...done”. In the example above, the app is 'fast-journey-73963' and the url is https://fast-journey-73963.herokuapp.com/.
        This will be unique for every Heroku application.</p>
        <p>The --buildpack option we are passing allows us to specify the Elixir buildpack we want Heroku to use. A buildpack is a convenient way of packaging framework and/or runtime support. In our case it’s installing our application dependencies before we run it.</p>
        <p> We need to compile static assets for a successful Phoenix deployment. The Phoenix Static Buildpack takes care of that for us, so let’s add it now.</p>
        <p>Inside your project directory in the terminal window, type the following:</p>
        <xmp>heroku buildpacks:add https://github.com/gjaldon/heroku-buildpack-phoenix-static.git</xmp>
        <p>Your output should be similar to that below:</p>
        <p><img src="/images/heroku-phoenix-buildpack.png" alt="heroku buildpack commands"  width="100%"></p>
        <p>To allow our database to work properly on Heroku, we will need to include the Heroku Postgres add-on. Click <a href="https://elements.heroku.com/addons/heroku-postgresql">here</a> to get started.</p>
        <p>Click the <strong>Install Heroku Postgres</strong> button.</p>
        <img src="/images/heroku_install_postgres.png" alt="heroku postgres commands"  width="100%">
        <be />
        <p>You will be prompted to select the name of your application from the drop down box. In this guide the application is called
        <strong>fast-journey-73963</strong>.</p>
        <p>The plan name will be similar to <code>Hobby Dev - Free</code>, simply select the provision button.</p>
        <img src="/images/heroku_provision.png" alt="heroku provision commands"  width="50%">
        <br />
        <h2>Modifying Some Files</h2>
        <p>We need to create a file in the root of our project called <code>Procfile</code> with the following content:</p>
        <p><code>web: MIX_ENV=prod mix phoenix.server</code></p>
        <p>Don't forget to save.</p>

        <p>Next, we need to open the file called prod.exs inside the config folder and replace the line</p>
        <code>cache_static_manifest: "priv/static/manifest.json"</code> with
        <xmp>
            cache_static_manifest: "priv/static/manifest.json",
            secret_key_base: System.get_env("SECRET_KEY_BASE")
        </xmp>
        <p>Here we’re saying that we want the secret_key_base value to be taken from the <a href="https://en.wikipedia.org/wiki/Environment_variable">environment variable</a> <strong>SECRET_KEY_BASE</strong>.</p>
        <p>Now we need to replace <code>url: [host: "example.com", port: 80],</code> with the name given to you by Heroku for your app. Please note this will <strong>not</strong> be the same as the sample below. Simply replace the host with your app name.</p>
        <p><code>url: [scheme: "https", host: "fast-journey-73963.herokuapp.com", port: 443],</code><br />
           <code>force_ssl: [rewrite_on: [:x_forwarded_proto]],</code>
        </p>
        <p>Finally we need to add/modify the following lines so the file resembles that below:</p>
        <xmp>
            config :blog_elixir_girls, BlogElixirGirls.Endpoint,
            http: [port: {:system, "PORT"}],
            url: [scheme: "https", host: "fast-journey-73963.herokuapp.com", port: 443],
            force_ssl: [rewrite_on: [:x_forwarded_proto]],
            cache_static_manifest: "priv/static/manifest.json",
            secret_key_base: Map.fetch!(System.get_env(), "SECRET_KEY_BASE")


            # Do not print debug messages in production
            config :logger, level: :info

            config :blog_elixir_girls, BlogElixirGirls.Repo,
            adapter: Ecto.Adapters.Postgres,
            username: System.get_env("USER_URL"),
            url: System.get_env("DATABASE_URL"),
            pool_size: 20,
            ssl: true

        </xmp>
        <p>Find the line <code>import_config "prod.secret.exs"</code> (it's located towards the end of the file) and delete it. Save your file :) </p>
        <p>Now open the file in web/channels/user_socket.ex and replace the line <code>transport :websocket, Phoenix.Transports.WebSocket</code> with:</p>
        <xmp>
            transport :websocket, Phoenix.Transports.WebSocket,
            timeout: 45_000
        </xmp>
        <p>Save all files and return to your terminal window.</p>
        <p>From within your project folder, enter the following commands one by one:</p>
        <p><code>heroku addons:create heroku-postgresql:hobby-dev</code></p>
        <p><code>heroku config:set POOL_SIZE=18</code></p>
        <p><code>heroku run "POOL_SIZE=2 mix blog_elixir_girls.task"</code></p>
        <p>You need to create the secret key we set in a previous step above. Lets do this now.</p>
        <p>At the terminal type the following:</p>
        <p><code>mix phoenix.gen.secret</code></p>
        <p>A random string will be generated. We need to set this in Heroku (remember to use the string your terminal generated and not the one in the example below).</p>
        <p>In the terminal window enter the following:</p>
        <p><code>heroku config:set SECRET_KEY_BASE="yH94rMfqsMpyLW4vkpAELsKLj3o01Shht/hyoTNslPjUo8Xxey3QNeDFdFqn2boN"</code></p>
        <h2>Deploy time</h2>
        <p>Let's commit all our changes!</p>
        <p>From the terminal window run the following commands one by one:</p>
        <xmp>
            git add config/prod.exs
            git add Procfile
            git add web/channels/user_socket.ex
            git commit -m 'setting up heroku to use our elixir girls blog app"
        </xmp>

        <h3>Deploy</h3>
        <p>Now we have all our changes queued up ready to go! To deploy them, run the following command:</p>
        <p><code>git push heroku master</code></p>
        <p>This has pushed all our code up onto Heroku, which means you can view it via your own unique url. However, we still need to migrate our database, so run the following command:</p>
        <p><code>heroku run "POOL_SIZE=2 mix ecto.migrate"</code></p>
        <h2>You are done!!!!</h2>
        <p>Type <code>heroku open</code> in your terminal window. Your browers window will open and will look similar to that below:</p>
        <p><img src="/images/heroku_done.png" alt="heroku deployed"  width="100%"></p></p>
    </div>
    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->

</body>

<!-- jQuery -->
<script src="/vendor/jquery/jquery.min.js"></script>
<!-- Bootstrap Core JavaScript -->
<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="/vendor/scrollreveal/scrollreveal.min.js"></script>
<script src="/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

<!-- Theme JavaScript -->
<script src="/javascripts/creative.js"></script>
<script src="/javascripts/all.js"></script>

</html>