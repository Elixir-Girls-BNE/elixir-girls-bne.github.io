---
title: Elixir Girls Guides Slackir App retrieving data
---

<%= partial "partials/guides-nav" %>

<div id="wrapper">

        <!-- Navigation -->
        <%= partial "partials/guides-sidebar-nav" %>

        <div id="page-wrapper">
          <h1>Retrieving from database</h1>
            <p>Everytime when you refresh your page, you lose the message history and that is not ideal. </p>
            <p>We have all these stored messages in our database and we want to retrieve it when someone logs in. Therefore, we will need to retrieve these messages and display them.</p>
            <h2>Perform a callback after join</h2>
            <p>Go to the <bold>join</bold> function, and add the line just below <bold>if authorized?(payload) do</bold></p>
            <p>We are going to send a message containg our self PID(Process Identifier) as the first parameter. The second parameter is a message to run a function called <em> after_join </em>. This function is identified by an atom type.</p>

            <% code("elixir") do %>
            def join("random:lobby", payload, socket) do
                if authorized?(payload) do
                  send self(), :after_join #<-- Add this line

            <% end %>

          <h4>What does send do?</h4>
          <p><em>send</em> manually sends a message <em>:after_join</em> with it's PID generated by the function <em>self()</em>. We want to be able to run the after join task asynchronously. Lets look at how we should receive the :after_join message</p>
          <h1>Handling a message in a callback</h1>
          <p></p>
          <% code("elixir") do %>
          def handle_info(:after_join, socket) do
            messages = Repo.all(Message)
            msgs =
              messages |> Enum.map(&to_msg/1)

            push socket, "messages_history", %{ messages: msgs }
            { :noreply, socket }
          end

          <% end %>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->


<!-- jQuery -->
<script src="vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="vendor/scrollreveal/scrollreveal.min.js"></script>
<script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

<!-- Theme JavaScript -->
<script src="javascripts/creative.js"></script>
<script src="javascripts/sidebar.js"></script>
